---
sidebar: sidebar 
permalink: task-restore-backups-ontap.html 
keywords: restoring, restore, restore volumes, restore files, restore folders, cloud backup, file restore, single file restore, folder restore, volume restore, browse and restore, search and restore, ONTAP 
summary: 'Les sauvegardes sont stockées dans un magasin d"objets de votre compte cloud, de sorte que vous puissiez restaurer les données à partir d"un point dans le temps spécifique. Vous pouvez restaurer un volume ONTAP entier à partir d"un fichier de sauvegarde ou, si vous n"avez qu"à restaurer quelques fichiers, vous pouvez restaurer un dossier ou des fichiers individuels à partir d"un fichier de sauvegarde.' 
---
= Restauration de données ONTAP à partir des fichiers de sauvegarde
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Les sauvegardes sont stockées dans un magasin d'objets de votre compte cloud, de sorte que vous puissiez restaurer les données à partir d'un point dans le temps spécifique. Vous pouvez restaurer un volume ONTAP entier à partir d'un fichier de sauvegarde ou, si vous n'avez qu'à restaurer quelques fichiers, vous pouvez restaurer un dossier ou des fichiers individuels à partir d'un fichier de sauvegarde.

Vous pouvez restaurer un *volume* (en tant que nouveau volume) dans l'environnement de travail d'origine, vers un environnement de travail différent qui utilise le même compte cloud ou sur un système ONTAP sur site.

Vous pouvez restaurer un *dossier* sur un volume de l'environnement de travail d'origine, sur un volume dans un environnement de travail différent qui utilise le même compte cloud ou sur un volume situé sur un système ONTAP sur site.

Vous pouvez restaurer *les fichiers* sur un volume de l'environnement de travail d'origine, sur un volume dans un autre environnement de travail qui utilise le même compte cloud ou sur un volume d'un système ONTAP sur site.

Une licence Cloud Backup valide est requise pour restaurer les données à partir des fichiers de sauvegarde vers un système de production.



== Le tableau de bord de restauration

Le tableau de bord de restauration permet d'effectuer des opérations de restauration de volumes, de dossiers et de fichiers. Pour accéder au Tableau de bord de restauration, cliquez sur *Backup and Recovery* dans le menu BlueXP, puis cliquez sur l'onglet *Restore*. Vous pouvez également cliquer sur image:screenshot_gallery_options.gif["Bouton plus"] > *Afficher le tableau de bord de restauration* à partir du service de sauvegarde et de récupération du panneau Services.


NOTE: Cloud Backup doit déjà être activé pour au moins un environnement de travail et les fichiers de sauvegarde initiaux doivent exister.

image:screenshot_restore_dashboard.png["Le tableau de bord de restauration affiche les options permettant d'utiliser la fonction Parcourir et AMP ; Restaurer ou Rechercher et amp ; Restaurer."]

Comme vous pouvez le voir, le tableau de bord de restauration propose deux façons différentes de restaurer des données à partir de fichiers de sauvegarde : *Browse & Restore* et *Search & Restore*.



== Comparer l'utilisation et la restauration et la recherche et la restauration

En termes généraux, _Browse & Restore_ est généralement mieux lorsque vous devez restaurer un volume, un dossier ou un fichier spécifique de la semaine ou du mois précédent -- vous connaissez le nom et l'emplacement du fichier, et la date à laquelle il a été en bonne forme. _Search & Restore_ est généralement préférable lorsque vous devez restaurer un volume, un dossier ou un fichier, mais vous ne vous souvenez pas du nom exact, du volume dans lequel il réside, ou de la date à laquelle il était en forme.

Ce tableau permet de comparer les deux méthodes.

[cols="50,50"]
|===
| Parcourir et restaurer | Recherche et restauration 


| Parcourez une structure de type dossier pour trouver le volume, le dossier ou le fichier dans un seul fichier de sauvegarde | Recherchez un volume, un dossier ou un fichier dans *tous les fichiers de sauvegarde* par nom de volume partiel ou complet, nom de dossier/fichier partiel ou complet, plage de tailles et filtres de recherche supplémentaires 


| La restauration de volumes et de fichiers fonctionne avec les fichiers de sauvegarde stockés dans Amazon S3, Azure Blob, Google Cloud et NetApp StorageGRID | La restauration de volumes et de fichiers fonctionne avec les fichiers de sauvegarde stockés dans Amazon S3, Azure Blob, Google Cloud et NetApp StorageGRID 


| Restaurez des volumes, des dossiers et des fichiers depuis StorageGRID sur des sites sans accès à Internet | Non pris en charge sur les sites sombres 


| Ne gère pas les fichiers qui ont été renommés ou supprimés | Gère les répertoires nouvellement créés/supprimés/renommés et les fichiers nouvellement créés/supprimés/renommés 


| Parcourez les résultats sur les clouds publics et privés | Parcourez les résultats dans les clouds publics et les copies Snapshot locales 


| Aucune ressource supplémentaire n'est requise du fournisseur de cloud | Ressources supplémentaires requises par compte pour les fournisseurs de compartiment et de cloud public 


| Aucun coût supplémentaire n'est requis du fournisseur de cloud | Coût associé aux ressources des fournisseurs de cloud public lors de l'analyse des sauvegardes et des volumes pour les résultats de recherche 
|===
Avant de pouvoir utiliser l'une ou l'autre méthode de restauration, assurez-vous d'avoir configuré votre environnement en fonction des besoins de ressources uniques. Ces exigences sont décrites dans les sections ci-dessous.

Reportez-vous aux étapes de configuration requise et de restauration pour le type d'opération de restauration que vous souhaitez utiliser :

* <<Restoring volumes using Browse & Restore,Restaurez les volumes à l'aide de Browse  ; restaurez
* <<Restoring folders and files using Browse & Restore,Restaurez les dossiers et les fichiers à l'aide de Browse  Restore
* <<Restoring ONTAP data using Search & Restore,Restaurez des volumes, des dossiers et des fichiers à l'aide de Search  ; Restore




== Restauration de données ONTAP à l'aide de Browse & Restore

Avant de commencer la restauration d'un volume, d'un dossier ou d'un fichier, vous devez connaître le nom du volume à partir duquel vous souhaitez restaurer, le nom de l'environnement de travail où réside le volume et la date approximative du fichier de sauvegarde à partir duquel vous souhaitez restaurer.

*Remarque :* si le fichier de sauvegarde contenant les données que vous souhaitez restaurer réside dans le stockage d'archives (à partir de ONTAP 9.10.1), l'opération de restauration prendra plus de temps et entraînera un coût. En outre, le cluster de destination doit également exécuter ONTAP 9.10.1 ou version ultérieure pour la restauration du volume, 9.11.1 pour la restauration des fichiers et 9.12.1 pour Google Archive et StorageGRID.

ifdef::aws[]

link:reference-aws-backup-tiers.html["En savoir plus sur la restauration à partir du stockage d'archivage AWS"].

endif::aws[]

ifdef::azure[]

link:reference-azure-backup-tiers.html["En savoir plus sur la restauration à partir du stockage d'archivage Azure"].

endif::azure[]

ifdef::gcp[]

link:reference-google-backup-tiers.html["En savoir plus sur la restauration à partir du stockage d'archivage Google"].

endif::gcp[]



=== Parcourir et restaurer les environnements de travail et les fournisseurs de stockage objet pris en charge

Vous pouvez restaurer un volume, un dossier ou des fichiers individuels depuis un fichier de sauvegarde ONTAP vers les environnements de travail suivants :

[cols="50,50"]
|===
| Emplacement du fichier de sauvegarde | Destination Environnement de travail ifdef::aws[] 


| Amazon S3 | Cloud Volumes ONTAP dans le système ONTAP sur site AWS endif::aws[] ifdef::Azure[] 


| Blob d'Azure | Cloud Volumes ONTAP dans le système ONTAP sur site Azure endif::Azure[] ifdef::gcp[] 


| Google Cloud Storage | Cloud Volumes ONTAP dans le système ONTAP sur site Google endif::gcp[] 


| NetApp StorageGRID | Système ONTAP sur site 
|===
Pour l'utilisation et la restauration, le connecteur peut être installé aux emplacements suivants :

ifdef::aws[]

* Pour Amazon S3, le connecteur peut être déployé dans AWS ou dans votre site


endif::aws[]

ifdef::azure[]

* Pour Azure Blob, le connecteur peut être déployé dans Azure ou dans votre site


endif::azure[]

ifdef::gcp[]

* Pour Google Cloud Storage, le connecteur doit être déployé dans votre VPC Google Cloud Platform


endif::gcp[]

* Pour StorageGRID, le connecteur doit être déployé sur site


Notez que les références aux « systèmes ONTAP sur site » incluent les systèmes FAS, AFF et ONTAP Select.


NOTE: Vous ne pouvez pas restaurer des dossiers ou des fichiers si le fichier de sauvegarde a été configuré avec DataLock & ransomware. Dans ce cas, vous pouvez restaurer tout le volume à partir du fichier de sauvegarde, puis accéder aux fichiers dont vous avez besoin.



=== Restauration de volumes à l'aide de Browse & Restore

Lorsque vous restaurez un volume à partir d'un fichier de sauvegarde, Cloud Backup crée un _nouveau_ volume en utilisant les données de la sauvegarde. Vous pouvez restaurer les données sur un volume de l'environnement de travail d'origine ou sur un autre environnement de travail situé dans le même compte cloud que l'environnement de travail source. Vous pouvez également restaurer des volumes sur un système ONTAP sur site.

image:diagram_browse_restore_volume.png["Schéma illustrant le flux d'exécution d'une opération de restauration de volume à l'aide de Browse  ; Restore."]

Comme vous pouvez le voir, vous devez connaître le nom de l'environnement de travail, le nom du volume et la date du fichier de sauvegarde pour pouvoir restaurer un volume.

La vidéo suivante montre une présentation rapide de la restauration d'un volume :

video::9Og5agUWyRk[youtube,width=848,height=480,end=164]
.Étapes
. Dans le menu BlueXP, sélectionnez *protection > sauvegarde et récupération*.
. Cliquez sur l'onglet *Restore* pour afficher le tableau de bord de restauration.
. Dans la section _Browse & Restore_, cliquez sur *Restore Volume*.
+
image:screenshot_restore_volume_selection.png["Capture d'écran de la sélection du bouton Restaurer les volumes dans le Tableau de bord de restauration."]

. Dans la page _Select Source_, accédez au fichier de sauvegarde du volume que vous souhaitez restaurer. Sélectionnez le *Environnement de travail*, le *Volume* et le fichier *Backup* dont l'horodatage doit être restauré.
+
image:screenshot_restore_select_volume_snapshot.png["Capture d'écran indiquant la sélection de l'environnement de travail, du volume et du fichier de sauvegarde de volume à restaurer."]

. Cliquez sur *Suivant*.
+
Si la protection par ransomware est active pour le fichier de sauvegarde (si vous avez activé DataLock et ransomware protection dans la stratégie de sauvegarde), vous êtes invité à exécuter une analyse par ransomware supplémentaire sur le fichier de sauvegarde avant de restaurer les données. Nous vous recommandons de scanner le fichier de sauvegarde à des fins d'attaques par ransomware.

. Dans la page _Select destination_, sélectionnez *Environnement de travail* où vous souhaitez restaurer le volume.
+
image:screenshot_restore_select_work_env_volume.png["Capture d'écran indiquant la sélection de l'environnement de travail de destination pour le volume à restaurer."]

. Si vous sélectionnez un système ONTAP sur site et que vous n'avez pas encore configuré la connexion de cluster au stockage objet, vous êtes invité à fournir des informations supplémentaires :
+
ifdef::aws[]

+
** Lors de la restauration depuis Amazon S3, sélectionnez l'IPspace dans le cluster ONTAP où se trouve le volume de destination, entrez la clé d'accès et la clé secrète pour l'utilisateur créé pour donner l'accès au cluster ONTAP au compartiment S3, Il est également possible de choisir un terminal VPC privé pour sécuriser le transfert de données.




endif::aws[]

ifdef::azure[]

* Lors de la restauration à partir d'Azure Blob, sélectionnez l'IPspace dans le cluster ONTAP où le volume de destination réside, sélectionnez l'abonnement Azure pour accéder au stockage objet, puis choisissez un terminal privé pour le transfert de données sécurisé en sélectionnant le vnet et le sous-réseau.


endif::azure[]

ifdef::gcp[]

* Lors d'une restauration à partir de Google Cloud Storage, sélectionnez Google Cloud Project, la clé d'accès et la clé secrète pour accéder au stockage objet, la région dans laquelle les sauvegardes sont stockées, et l'IPspace dans le cluster ONTAP où réside le volume de destination.


endif::gcp[]

* Lors de la restauration à partir de StorageGRID, entrez le FQDN du serveur StorageGRID et le port que ONTAP doit utiliser pour la communication HTTPS avec StorageGRID, sélectionnez la clé d'accès et la clé secrète nécessaires pour accéder au stockage objet, et l'IPspace dans le cluster ONTAP où le volume de destination résidera.
+
.. Entrez le nom à utiliser pour le volume restauré, puis sélectionnez le VM de stockage et l'agrégat dans lequel le volume sera stocké. Par défaut, *<source_volume_name>_restore* est utilisé comme nom de volume.
+
image:screenshot_restore_new_vol_name.png["Capture d'écran indiquant le nom du nouveau volume à restaurer."]

+
Et si vous restaurez le volume à partir d'un fichier de sauvegarde résidant sur un niveau de stockage d'archives (disponible à partir de ONTAP 9.10.1), vous pouvez sélectionner la priorité de restauration.

+
ifdef::aws[]





link:reference-aws-backup-tiers.html#restoring-data-from-archival-storage["En savoir plus sur la restauration à partir du stockage d'archivage AWS"].

endif::aws[]

ifdef::azure[]

link:reference-azure-backup-tiers.html#restoring-data-from-archival-storage["En savoir plus sur la restauration à partir du stockage d'archivage Azure"].

endif::azure[]

ifdef::gcp[]

link:reference-google-backup-tiers.html#restoring-data-from-archival-storage["En savoir plus sur la restauration à partir du stockage d'archivage Google"]. Les fichiers de sauvegarde du niveau de stockage Google Archive sont restaurés presque immédiatement, sans priorité de restauration.

endif::gcp[]

. Cliquez sur *Restaurer* et vous revenez au Tableau de bord de restauration pour vérifier la progression de l'opération de restauration.


.Résultat
Cloud Backup crée un nouveau volume en fonction de la sauvegarde que vous avez sélectionnée. C'est possible link:task-manage-backups-ontap.html["gérez les paramètres de sauvegarde de ce nouveau volume"] selon les besoins.

Notez que la restauration d'un volume à partir d'un fichier de sauvegarde qui réside dans le stockage d'archivage peut prendre plusieurs minutes ou heures, selon le niveau d'archivage et la priorité de restauration. Vous pouvez cliquer sur l'onglet *surveillance des travaux* pour voir la progression de la restauration.



=== Restauration des dossiers et des fichiers à l'aide de la fonction Parcourir et Restaurer

Si vous n'avez besoin de restaurer que quelques fichiers depuis la sauvegarde d'un volume ONTAP, vous avez la possibilité de restaurer un dossier ou des fichiers individuels au lieu de restaurer tout le volume. Vous pouvez restaurer des dossiers et des fichiers vers un volume existant dans l'environnement de travail d'origine ou vers un autre environnement de travail utilisant le même compte cloud. Vous pouvez également restaurer des dossiers et des fichiers vers un volume situé sur un système ONTAP sur site.

Si vous sélectionnez plusieurs fichiers, tous les fichiers sont restaurés sur le même volume de destination que vous choisissez. Si vous souhaitez restaurer des fichiers sur différents volumes, vous devez exécuter le processus de restauration plusieurs fois.

Pour le moment, vous ne pouvez sélectionner et restaurer qu'un seul dossier. Et seuls les fichiers de ce dossier sont restaurés - aucun sous-dossier, ni aucun fichier dans des sous-dossiers, n'est restauré.

[NOTE]
====
* Vous ne pouvez pas restaurer des dossiers ou des fichiers si le fichier de sauvegarde a été configuré avec DataLock & ransomware. Dans ce cas, vous pouvez restaurer tout le volume à partir du fichier de sauvegarde, puis accéder aux fichiers dont vous avez besoin.
* La restauration au niveau des dossiers n'est actuellement pas prise en charge lorsque le fichier de sauvegarde se trouve dans le stockage d'archivage. Dans ce cas, vous pouvez restaurer le dossier à partir d'un fichier de sauvegarde plus récent qui n'a pas été archivé, ou vous pouvez restaurer le volume entier à partir de la sauvegarde archivée, puis accéder au dossier et aux fichiers dont vous avez besoin.


====


==== Prérequis

* La version ONTAP doit être 9.6 ou supérieure pour effectuer des opérations _file_ restore.
* La version ONTAP doit être 9.11.1 ou supérieure pour effectuer des opérations _folder_ restore. ifdef::aws[]


endif::aws[]



==== Processus de restauration des dossiers et des fichiers

Le processus se présente comme suit :

. Lorsque vous souhaitez restaurer un dossier ou un ou plusieurs fichiers à partir d'une sauvegarde de volume, cliquez sur l'onglet *Restaurer*, puis sur *Restaurer les fichiers ou le dossier* sous _Parcourir et Restaurer_.
. Sélectionnez l'environnement de travail source, le volume et le fichier de sauvegarde dans lequel le dossier ou le fichier(s) résident(s).
. Cloud Backup affiche les dossiers et les fichiers qui existent dans le fichier de sauvegarde sélectionné.
. Sélectionnez le ou les fichiers que vous souhaitez restaurer à partir de cette sauvegarde.
. Sélectionnez l'emplacement de destination où vous souhaitez restaurer le dossier ou le fichier(s) (l'environnement de travail, le volume et le dossier), puis cliquez sur *Restaurer*.
. Les fichiers sont restaurés.


image:diagram_browse_restore_file.png["Schéma illustrant le flux d'exécution d'une opération de restauration de fichier à l'aide de Browse  ; Restore."]

Comme vous pouvez le voir, vous devez connaître le nom de l'environnement de travail, le nom du volume, la date du fichier de sauvegarde et le nom du dossier/fichier pour effectuer la restauration d'un dossier ou d'un fichier.



==== Restauration des dossiers et des fichiers

Procédez comme suit pour restaurer des dossiers ou des fichiers vers un volume à partir d'une sauvegarde de volume ONTAP. Vous devez connaître le nom du volume et la date du fichier de sauvegarde que vous souhaitez utiliser pour restaurer le dossier ou le(s) fichier(s). Cette fonctionnalité utilise la navigation en direct pour afficher la liste des répertoires et des fichiers de chaque fichier de sauvegarde.

La vidéo suivante montre une présentation rapide de la restauration d'un seul fichier :

video::9Og5agUWyRk[youtube,width=848,height=480,start=165]
.Étapes
. Dans le menu BlueXP, sélectionnez *protection > sauvegarde et récupération*.
. Cliquez sur l'onglet *Restore* pour afficher le tableau de bord de restauration.
. Dans la section _Browse & Restore_, cliquez sur *Restore files ou Folder*.
+
image:screenshot_restore_files_selection.png["Capture d'écran de la sélection du bouton Restaurer les fichiers ou dossier dans le Tableau de bord de restauration."]

. Dans la page _Select Source_, accédez au fichier de sauvegarde du volume contenant le ou les fichiers à restaurer. Sélectionnez *Environnement de travail*, *Volume* et *Backup* qui possède l'horodatage à partir duquel vous souhaitez restaurer les fichiers.
+
image:screenshot_restore_select_source.png["Capture d'écran de sélection du volume et de la sauvegarde des éléments à restaurer."]

. Cliquez sur *Suivant* et la liste des dossiers et fichiers de la sauvegarde de volume s'affiche.
+
Si vous restaurez des dossiers ou des fichiers à partir d'un fichier de sauvegarde résidant sur un niveau de stockage d'archives (disponible à partir de ONTAP 9.10.1), vous pouvez sélectionner la priorité de restauration.

+
ifdef::aws[]



link:reference-aws-backup-tiers.html#restoring-data-from-archival-storage["En savoir plus sur la restauration à partir du stockage d'archivage AWS"].

endif::aws[]

ifdef::azure[]

link:reference-azure-backup-tiers.html#restoring-data-from-archival-storage["En savoir plus sur la restauration à partir du stockage d'archivage Azure"].

endif::azure[]

ifdef::gcp[]

link:reference-google-backup-tiers.html#restoring-data-from-archival-storage["En savoir plus sur la restauration à partir du stockage d'archivage Google"]. Les fichiers de sauvegarde du niveau de stockage Google Archive sont restaurés presque immédiatement, sans priorité de restauration.

endif::gcp[]

+ et si la protection par ransomware est active pour le fichier de sauvegarde (si vous avez activé DataLock et ransomware protection dans la stratégie de sauvegarde), vous êtes invité à exécuter une analyse par ransomware supplémentaire sur le fichier de sauvegarde avant de restaurer les données. Nous vous recommandons de scanner le fichier de sauvegarde à des fins d'attaques par ransomware.

+image:screenshot_restore_select_files.png["Capture d'écran de la page Sélectionner des éléments pour accéder aux éléments à restaurer."]

. Dans la page _Select Items_, sélectionnez le ou les fichiers que vous souhaitez restaurer et cliquez sur *Continuer*. Pour vous aider à trouver l'élément :
+
** Vous pouvez cliquer sur le nom du dossier ou du fichier si vous le voyez.
** Vous pouvez cliquer sur l'icône de recherche et saisir le nom du dossier ou du fichier pour naviguer directement vers l'élément.
** Vous pouvez naviguer vers le bas niveaux dans les dossiers à l'aide de image:button_subfolder.png[""] à la fin de la ligne pour trouver des fichiers spécifiques.
+
Lorsque vous sélectionnez des fichiers, ils sont ajoutés à gauche de la page pour voir les fichiers que vous avez déjà sélectionnés. Si nécessaire, vous pouvez supprimer un fichier de cette liste en cliquant sur *x* en regard du nom du fichier.



. Dans la page _Select destination_, sélectionnez *Environnement de travail* où vous souhaitez restaurer les éléments.
+
image:screenshot_restore_select_work_env.png["Capture d'écran indiquant la sélection de l'environnement de travail de destination pour les éléments à restaurer."]

+
Si vous sélectionnez un cluster sur site et que vous n'avez pas encore configuré la connexion de cluster au stockage objet, vous êtes invité à fournir des informations supplémentaires :

+
ifdef::aws[]

+
** Lors de la restauration depuis Amazon S3, entrez l'IPspace dans le cluster ONTAP où réside le volume de destination, ainsi que la clé d'accès AWS et la clé secrète nécessaires pour accéder au stockage objet. Vous pouvez également sélectionner une configuration de liaison privée pour la connexion au cluster.




endif::aws[]

ifdef::azure[]

* Lors de la restauration à partir d'Azure Blob, entrez l'IPspace dans le cluster ONTAP où réside le volume cible. Vous pouvez également sélectionner une configuration de point final privé pour la connexion au cluster.


endif::azure[]

ifdef::gcp[]

* Lors d'une restauration à partir de Google Cloud Storage, entrez l'IPspace dans le cluster ONTAP où résident les volumes de destination, ainsi que la clé d'accès et la clé secrète nécessaires pour accéder au stockage objet.


endif::gcp[]

* Lors d'une restauration à partir de StorageGRID, entrez le FQDN du serveur StorageGRID et le port que ONTAP doit utiliser pour la communication HTTPS avec StorageGRID, entrez la clé d'accès et la clé secrète nécessaires pour accéder au stockage objet, et l'IPspace dans le cluster ONTAP où réside le volume de destination.
+
.. Sélectionnez ensuite le *Volume* et le *dossier* où vous souhaitez restaurer le ou les dossiers.
+
image:screenshot_restore_select_dest.png["Capture d'écran de sélection du volume et du dossier des fichiers à restaurer."]

+
Vous disposez de quelques options pour l'emplacement de restauration des dossiers et des fichiers.



* Lorsque vous avez choisi *Sélectionner le dossier cible*, comme indiqué ci-dessus :
+
** Vous pouvez sélectionner n'importe quel dossier.
** Vous pouvez passer le curseur de la souris sur un dossier et cliquer sur image:button_subfolder.png[""] à la fin de la ligne pour accéder aux sous-dossiers, puis sélectionner un dossier.


* Si vous avez sélectionné le même environnement de travail et le même volume que le dossier/fichier source, vous pouvez sélectionner *gérer le chemin du dossier source* pour restaurer le dossier ou les fichiers dans le dossier où ils existent dans la structure source. Tous les mêmes dossiers et sous-dossiers doivent déjà exister ; les dossiers ne sont pas créés. Lorsque vous restaurez les fichiers à leur emplacement d'origine, vous pouvez choisir d'écraser le ou les fichiers source ou de créer de nouveaux fichiers.
+
.. Cliquez sur *Restaurer* et vous revenez au Tableau de bord de restauration pour vérifier la progression de l'opération de restauration. Vous pouvez également cliquer sur l'onglet *surveillance des travaux* pour voir la progression de la restauration.






== Restauration de données ONTAP à l'aide de la fonction de recherche et de restauration

Vous pouvez restaurer un volume, un dossier ou des fichiers à partir d'un fichier de sauvegarde ONTAP à l'aide de la fonction Rechercher et restaurer. La fonction de recherche et restauration vous permet de rechercher un volume, un dossier ou un fichier spécifique à partir de toutes les sauvegardes stockées dans le stockage cloud pour un fournisseur spécifique, puis d'effectuer une restauration. Il n'est pas nécessaire de connaître le nom exact de l'environnement de travail ou le nom du volume ; la recherche s'effectue via tous les fichiers de sauvegarde de volume.

L'opération de recherche examine également toutes les copies Snapshot locales existant pour vos volumes ONTAP. Étant donné que la restauration des données à partir d'une copie Snapshot locale peut être plus rapide et moins coûteuse que la restauration à partir d'un fichier de sauvegarde, il est possible de restaurer les données à partir d'une copie Snapshot. Vous pouvez restaurer l'instantané en tant que nouveau volume à partir de la page Volume Details (Détails du volume) de la toile (pas à partir de Cloud Backup).

Lorsque vous restaurez un volume à partir d'un fichier de sauvegarde, Cloud Backup crée un _nouveau_ volume en utilisant les données de la sauvegarde. Vous pouvez restaurer les données en tant que volume dans l'environnement de travail d'origine ou vers un autre environnement de travail situé dans le même compte cloud que l'environnement de travail source. Vous pouvez également restaurer des volumes sur un système ONTAP sur site.

Vous pouvez restaurer des dossiers ou des fichiers vers l'emplacement du volume d'origine, vers un autre volume dans le même environnement de travail ou vers un autre environnement de travail qui utilise le même compte cloud. Vous pouvez également restaurer des dossiers et des fichiers vers un volume situé sur un système ONTAP sur site.

Si le fichier de sauvegarde du volume que vous souhaitez restaurer se trouve dans le stockage d'archives (disponible à partir de ONTAP 9.10.1), l'opération de restauration prend plus de temps et entraînera des coûts supplémentaires. Notez que le cluster de destination doit également exécuter ONTAP 9.10.1 ou version ultérieure pour la restauration de volume, 9.11.1 pour la restauration de fichiers et 9.12.1 pour Google Archive et StorageGRID.

ifdef::aws[]

link:reference-aws-backup-tiers.html["En savoir plus sur la restauration à partir du stockage d'archivage AWS"].

endif::aws[]

ifdef::azure[]

link:reference-azure-backup-tiers.html["En savoir plus sur la restauration à partir du stockage d'archivage Azure"].

endif::azure[]

ifdef::gcp[]

link:reference-google-backup-tiers.html["En savoir plus sur la restauration à partir du stockage d'archivage Google"].

endif::gcp[]

[NOTE]
====
* Vous ne pouvez pas restaurer des dossiers ou des fichiers si le fichier de sauvegarde a été configuré avec DataLock & ransomware. Dans ce cas, vous pouvez restaurer tout le volume à partir du fichier de sauvegarde, puis accéder aux fichiers dont vous avez besoin.
* La restauration au niveau des dossiers n'est actuellement pas prise en charge lorsque le fichier de sauvegarde se trouve dans le stockage d'archivage. Dans ce cas, vous pouvez restaurer le dossier à partir d'un fichier de sauvegarde plus récent qui n'a pas été archivé, ou vous pouvez restaurer le volume entier à partir de la sauvegarde archivée, puis accéder au dossier et aux fichiers dont vous avez besoin.


====
Avant de commencer, vous devriez avoir une idée du nom ou de l'emplacement du volume ou du fichier à restaurer.

La vidéo suivante montre une présentation rapide de la restauration d'un seul fichier :

video::RZktLe32hhQ[youtube,width=848,height=480]


=== Rechercher et restaurer les environnements de travail et les fournisseurs de stockage objet pris en charge

Vous pouvez restaurer un volume, un dossier ou des fichiers individuels depuis un fichier de sauvegarde ONTAP vers les environnements de travail suivants :

[cols="35,45"]
|===
| Emplacement du fichier de sauvegarde | Destination Environnement de travail ifdef::aws[] 


| Amazon S3 | Cloud Volumes ONTAP dans le système ONTAP sur site AWS endif::aws[] ifdef::Azure[] 


| Blob d'Azure | Cloud Volumes ONTAP dans le système ONTAP sur site Azure endif::Azure[] ifdef::gcp[] 


| Google Cloud Storage | Cloud Volumes ONTAP dans le système ONTAP sur site Google endif::gcp[] 


| NetApp StorageGRID | Système ONTAP sur site 
|===
Pour la recherche et la restauration, le connecteur peut être installé aux emplacements suivants :

ifdef::aws[]

* Pour Amazon S3, le connecteur peut être déployé dans AWS ou dans votre site


endif::aws[]

ifdef::azure[]

* Pour Azure Blob, le connecteur peut être déployé dans Azure ou dans votre site


endif::azure[]

ifdef::gcp[]

* Pour Google Cloud Storage, le connecteur doit être déployé dans votre VPC Google Cloud Platform


endif::gcp[]

* Pour StorageGRID, le connecteur doit être déployé dans vos locaux avec une connexion Internet


Notez que les références aux « systèmes ONTAP sur site » incluent les systèmes FAS, AFF et ONTAP Select.



=== Prérequis

* Configuration requise pour le cluster :
+
** La version ONTAP doit être supérieure ou égale à 9.8.
** La VM de stockage (SVM) sur laquelle réside le volume doit avoir une LIF de données configurée.
** NFS doit être activé sur le volume (les volumes NFS et SMB/CIFS sont pris en charge).
** Le serveur RPC SnapDiff doit être activé sur le SVM. BlueXP le fait automatiquement lorsque vous activez l'indexation sur l'environnement de travail. (SnapDiff est la technologie qui identifie rapidement les différences entre les fichiers et les répertoires entre deux copies Snapshot.)




ifdef::aws[]

* Configuration AWS requise :
+
** Des autorisations spécifiques pour Amazon Athena, AWS Glue et AWS S3 doivent être ajoutées au rôle utilisateur qui fournit les autorisations BlueXP. link:task-backup-onprem-to-aws.html#set-up-s3-permissions["Assurez-vous que toutes les autorisations sont correctement configurées"].
+
Notez que si vous utilisiez déjà Cloud Backup avec un connecteur que vous avez configuré dans le passé, vous devrez ajouter maintenant les autorisations Athena et Glue au rôle utilisateur BlueXP. Ils sont nouveaux et sont requis pour la recherche et la restauration.





endif::aws[]

ifdef::azure[]

* Configuration d'Azure :
+
** Vous devez enregistrer le fournisseur de ressources Azure Synapse Analytics auprès de votre abonnement. https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/resource-providers-and-types#register-resource-provider["Découvrez comment enregistrer ce fournisseur de ressources pour votre abonnement"^]. Vous devez être l'abonnement *propriétaire* ou *Contributeur* pour enregistrer le fournisseur de ressources.
** Des autorisations spécifiques pour Azure Synapse Workspace et Data Lake Storage Account doivent être ajoutées au rôle utilisateur qui fournit à BlueXP des autorisations. link:task-backup-onprem-to-azure.html#verify-or-add-permissions-to-the-connector["Assurez-vous que toutes les autorisations sont correctement configurées"].
+
Notez que si vous utilisiez déjà Cloud Backup avec un connecteur que vous avez configuré auparavant, vous devrez désormais ajouter les autorisations pour les comptes de stockage Azure Synapse Workspace et Data Lake au rôle utilisateur BlueXP. Ils sont nouveaux et sont requis pour la recherche et la restauration.

** Le connecteur doit être configuré *sans* serveur proxy pour la communication HTTP vers Internet. Si vous avez configuré un serveur proxy HTTP pour votre connecteur, vous ne pouvez pas utiliser la fonctionnalité Rechercher et remplacer.




endif::azure[]

ifdef::gcp[]

* Exigences Google Cloud :
+
** Des autorisations Google BigQuery spécifiques doivent être ajoutées au rôle utilisateur qui fournit des autorisations BlueXP. link:task-backup-onprem-to-gcp.html#verify-or-add-permissions-to-the-connector["Assurez-vous que toutes les autorisations sont correctement configurées"].
+
Notez que si vous utilisiez déjà Cloud Backup avec un connecteur que vous avez configuré auparavant, vous devrez ajouter maintenant les autorisations BigQuery au rôle utilisateur BlueXP. Ils sont nouveaux et sont requis pour la recherche et la restauration.





endif::gcp[]

* Configuration minimale requise pour StorageGRID :
+
En fonction de votre configuration, la recherche et la restauration peuvent être mises en œuvre de deux façons :

+
** S'il n'y a pas d'identifiants de fournisseur de cloud dans votre compte, les informations de catalogue indexées sont stockées sur le connecteur.
** Si vous l'avez https://docs.netapp.com/us-en/cloud-manager-setup-admin/concept-accounts-aws.html["Identifiants AWS"^] ou https://docs.netapp.com/us-en/cloud-manager-setup-admin/concept-accounts-azure.html["Identifiants Azure"^] Dans le compte, le catalogue indexé est stocké sur le fournisseur cloud, comme avec un connecteur déployé dans le cloud. (Si vous disposez des deux identifiants, AWS est sélectionné par défaut.)
+
Même si vous utilisez un connecteur sur site, les exigences du fournisseur cloud doivent être respectées tant pour les autorisations de connecteur que pour les ressources du fournisseur cloud. Consultez les exigences AWS et Azure ci-dessus lors de l'utilisation de cette implémentation.







=== Processus de recherche et de restauration

Le processus se présente comme suit :

. Avant de pouvoir utiliser la fonction de recherche et de restauration, vous devez activer « indexation » sur chaque environnement de travail source à partir duquel vous souhaitez restaurer les données du volume. Cela permet au catalogue indexé de suivre les fichiers de sauvegarde pour chaque volume.
. Lorsque vous souhaitez restaurer un ou plusieurs volumes à partir d'une sauvegarde de volume, sous _Rechercher et Restaurer_, cliquez sur *Rechercher et restaurer*.
. Entrez les critères de recherche d'un volume, d'un dossier ou d'un fichier par nom de volume partiel ou complet, nom de fichier partiel ou complet, plage de tailles, plage de dates de création, autres filtres de recherche, puis cliquez sur *Rechercher*.
+
La page Résultats de la recherche affiche tous les emplacements qui ont un fichier ou un volume correspondant à vos critères de recherche.

. Cliquez sur *Afficher toutes les sauvegardes* pour l'emplacement que vous souhaitez utiliser pour restaurer le volume ou le fichier, puis cliquez sur *Restaurer* sur le fichier de sauvegarde réel que vous souhaitez utiliser.
. Sélectionnez l'emplacement où vous souhaitez restaurer le volume, le dossier ou le(s) fichier(s) et cliquez sur *Restaurer*.
. Le volume, le dossier ou le(s) fichier(s) sont restaurés(s).


image:diagram_search_restore_vol_file.png["Schéma illustrant le flux d'exécution d'une opération de restauration de volume, de dossier ou de fichier à l'aide de la fonction Rechercher et amp ; Restaurer."]

Comme vous pouvez le voir, vous n'avez besoin que d'un nom partiel et de recherches sur Cloud Backup dans tous les fichiers de sauvegarde qui correspondent à votre recherche.



=== Activation du catalogue indexé pour chaque environnement de travail

Avant de pouvoir utiliser la fonction de recherche et de restauration, vous devez activer l'indexation sur chaque environnement de travail source à partir duquel vous prévoyez de restaurer des volumes ou des fichiers. Cela permet au catalogue indexé de suivre chaque volume et chaque fichier de sauvegarde, ce qui rend vos recherches très rapides et efficaces.

Lorsque vous activez cette fonctionnalité, Cloud Backup permet à SnapDiff v3 sur le SVM pour vos volumes, et effectue les actions suivantes :

ifdef::aws[]

* Pour les sauvegardes stockées dans AWS, un nouveau compartiment S3 est provisionné et le https://aws.amazon.com/athena/faqs/["Service de requête interactive Amazon Athena"^] et https://aws.amazon.com/glue/faqs/["Service d'intégration de données sans serveur AWS Glue"^].


endif::aws[]

ifdef::azure[]

* Pour les sauvegardes stockées dans Azure, cet espace de travail s'provisionne un espace de travail Azure Synapse et un système de fichiers Data Lake comme conteneur qui stockera les données de l'espace de travail.


endif::azure[]

ifdef::gcp[]

* Pour les sauvegardes stockées dans Google Cloud, un nouveau compartiment est provisionné, et le https://cloud.google.com/bigquery["Services Google Cloud BigQuery"^] sont provisionnées au niveau compte/projet.


endif::gcp[]

* Pour les sauvegardes stockées dans StorageGRID, l'espace est provisionné sur le connecteur ou sur l'environnement du fournisseur cloud.


Si l'indexation a déjà été activée pour votre environnement de travail, passez à la section suivante pour restaurer vos données.

Pour activer l'indexation pour un environnement de travail :

* Si aucun environnement de travail n'a été indexé, dans le tableau de bord de restauration sous _Search & Restore_, cliquez sur *Activer l'indexation pour les environnements de travail*, puis sur *Activer l'indexation* pour l'environnement de travail.
* Si au moins un environnement de travail a déjà été indexé, dans le tableau de bord de restauration sous _Search & Restore_, cliquez sur *Indexing Settings*, puis sur *Enable Indexing* pour l'environnement de travail.


Une fois que tous les services sont provisionnés et que le catalogue indexé a été activé, l'environnement de travail est affiché comme « actif ».

image:screenshot_restore_enable_indexing.png["Capture d'écran montrant les environnements de travail qui ont activé le catalogue indexé."]

Selon la taille des volumes de l'environnement de travail et le nombre de fichiers de sauvegarde dans le cloud, le processus d'indexation initial peut prendre jusqu'à une heure. Par la suite, elle est mise à jour de manière transparente toutes les heures avec des modifications incrémentielles pour maintenir des données à jour.



=== Restauration de volumes, de dossiers et de fichiers à l'aide de la fonction Rechercher et Restaurer

Après vous <<Activation du catalogue indexé pour chaque environnement de travail,Indexation activée pour votre environnement de travail>>, Vous pouvez restaurer des volumes, des dossiers et des fichiers à l'aide de la fonction Rechercher et restaurer. Cela vous permet d'utiliser une large gamme de filtres pour trouver le fichier ou volume exact que vous souhaitez restaurer à partir de tous les fichiers de sauvegarde.

.Étapes
. Dans le menu BlueXP, sélectionnez *protection > sauvegarde et récupération*.
. Cliquez sur l'onglet *Restore* pour afficher le tableau de bord de restauration.
. Dans la section _Search & Restore_, cliquez sur *Search & Restore*.
+
image:screenshot_restore_start_search_restore.png["Capture d'écran de sélection du bouton Rechercher et restaurer dans le tableau de bord de restauration."]

. À partir de la page Rechercher pour restaurer :
+
.. Dans la barre de recherche _Search_, entrez un nom de volume complet ou partiel, un nom de dossier ou un nom de fichier.
.. Sélectionnez le type de ressource : *volumes*, *fichiers*, *dossiers* ou *tous*.
.. Dans la zone _Filter by_, sélectionnez les critères de filtre. Par exemple, vous pouvez sélectionner l'environnement de travail où se trouvent les données et le type de fichier, par exemple un fichier .JPEG.


. Cliquez sur *Rechercher* et la zone Résultats de la recherche affiche toutes les ressources qui ont un fichier, un dossier ou un volume correspondant à votre recherche.
+
image:screenshot_restore_step1_search_restore.png["Capture d'écran affichant les critères de recherche et les résultats de la recherche sur la page Rechercher et restaurer."]

. Cliquez sur *Afficher toutes les sauvegardes* pour la ressource contenant les données à restaurer pour afficher tous les fichiers de sauvegarde contenant le volume, le dossier ou le fichier correspondant.
+
image:screenshot_restore_step2_search_restore.png["Capture d'écran montrant comment afficher toutes les sauvegardes correspondant à vos critères de recherche."]

. Cliquez sur *Restaurer* pour le fichier de sauvegarde que vous souhaitez utiliser pour restaurer l'élément à partir du nuage.
+
Notez que les résultats identifient également les copies Snapshot de volume local contenant le fichier dans votre recherche. Le bouton *Restore* n'est pas fonctionnel pour les instantanés à ce moment, mais si vous souhaitez restaurer les données à partir de la copie Snapshot au lieu du fichier de sauvegarde, notez le nom et l'emplacement du volume, ouvrez la page Détails du volume sur la toile, Et utilisez l'option *Restaurer à partir de la copie Snapshot*.

. Sélectionnez l'emplacement de destination où vous souhaitez restaurer le volume, le dossier ou le(s) fichier(s) et cliquez sur *Restaurer*.
+
** Pour les volumes, vous pouvez sélectionner l'environnement de travail de destination d'origine ou sélectionner un autre environnement de travail.
** Pour les dossiers, vous pouvez restaurer l'emplacement d'origine ou sélectionner un autre emplacement, y compris l'environnement de travail, le volume et le dossier.
** Pour les fichiers, vous pouvez restaurer l'emplacement d'origine ou sélectionner un autre emplacement, y compris l'environnement de travail, le volume et le dossier. Lorsque vous sélectionnez l'emplacement d'origine, vous pouvez choisir d'écraser le ou les fichiers source ou de créer de nouveaux fichiers.
+
Si vous sélectionnez un système ONTAP sur site et que vous n'avez pas encore configuré la connexion de cluster au stockage objet, vous êtes invité à fournir des informations supplémentaires :

+
ifdef::aws[]

+
*** Lors de la restauration depuis Amazon S3, sélectionnez l'IPspace dans le cluster ONTAP où se trouve le volume de destination, entrez la clé d'accès et la clé secrète pour l'utilisateur créé pour donner l'accès au cluster ONTAP au compartiment S3, Il est également possible de choisir un terminal VPC privé pour sécuriser le transfert de données. link:task-backup-onprem-to-aws.html#cluster-networking-requirements["Reportez-vous aux détails de ces exigences"].






endif::aws[]

ifdef::azure[]

* Lors de la restauration à partir d'Azure Blob, sélectionnez l'IPspace dans le cluster ONTAP où réside le volume de destination, puis choisissez un terminal privé pour le transfert de données sécurisé en sélectionnant le vnet et le sous-réseau. link:task-backup-onprem-to-azure.html#requirements["Reportez-vous aux détails de ces exigences"].


endif::azure[]

ifdef::gcp[]

* Lors de la restauration à partir de Google Cloud Storage, sélectionnez l'IPspace dans le cluster ONTAP où réside le volume de destination, ainsi que la clé d'accès et la clé secrète pour accéder au stockage objet. link:task-backup-onprem-to-gcp.html#requirements["Reportez-vous aux détails de ces exigences"].


endif::gcp[]

* Lors d'une restauration à partir de StorageGRID, entrez le FQDN du serveur StorageGRID et le port que ONTAP doit utiliser pour la communication HTTPS avec StorageGRID, entrez la clé d'accès et la clé secrète nécessaires pour accéder au stockage objet, et l'IPspace dans le cluster ONTAP où réside le volume de destination. link:task-backup-onprem-private-cloud.html#requirements["Reportez-vous aux détails de ces exigences"].


.Résultats
Le volume, le dossier ou le(s) fichier(s) sont restaurés et vous revenez au tableau de bord de restauration pour vérifier la progression de l'opération de restauration. Vous pouvez également cliquer sur l'onglet *surveillance des travaux* pour voir la progression de la restauration.

Pour les volumes restaurés, vous pouvez link:task-manage-backups-ontap.html["gérez les paramètres de sauvegarde de ce nouveau volume"] selon les besoins.
